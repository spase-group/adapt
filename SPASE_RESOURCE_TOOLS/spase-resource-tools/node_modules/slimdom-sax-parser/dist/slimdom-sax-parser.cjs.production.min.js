"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("slimdom"),t=require("saxes"),e=require("stream"),o={xmlns:!0,position:!1,additionalEntities:{}},i={"":null,xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function r(){return(r=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n}).apply(this,arguments)}var a={getCurrentPosition:function(){return{offset:0,line:0,column:0}},trackAttributePosition:function(n){return n},trackNodeClosePosition:function(n){return n},trackNodePosition:function(n){return n},updateLastTrackedPosition:function(){}};function s(t,e){var o=new n.Document,r=o,s=function(n){var t=[i];return void 0!==n&&t.unshift(n),{push:function(n){return t.unshift(n)},pop:function(){return t.shift()},location:function(n){var e;return void 0===n?n:null==(e=t.find((function(t){return void 0!==t[n]})))?void 0:e[n]}}}(e.additionalNamespaces||{}),c=e.position?function(n){var t={line:1,column:1,offset:0};function e(t){var e={offset:n.position,line:n.line,column:n.column+1};return t?(3===t.nodeType?(e.offset--,e.column--):8===t.nodeType&&(e.offset++,e.column++),e):e}return{getCurrentPosition:e,trackAttributePosition:function(n,t){return n.position={end:t.offset},n},trackNodeClosePosition:function(n){var o=e(n);return n.closePosition={line:t.line,column:t.column,start:t.offset,end:o.offset},t=o,n},trackNodePosition:function(n){var o=e(n);return n.position={line:t.line,column:t.column,start:t.offset,end:o.offset},t=o,n},updateLastTrackedPosition:function(){t=e()}}}(t):a,u=c.trackNodePosition,l=c.trackNodeClosePosition,d=c.updateLastTrackedPosition,f=c.getCurrentPosition,p=c.trackAttributePosition,m=new Map;return{onText:function(n){if(r!==o){var t=u(o.createTextNode(n));r.appendChild(t)}else d()},onOpenTag:function(n){n.ns&&s.push(n.ns);var t=s.location(n.prefix);if(void 0===t)throw new Error('Could not resolve a namespace location for "'+n.prefix+'"');var e=u(o.createElementNS(t,n.name));Object.keys(n.attributes).map((function(t){return n.attributes[t]})).forEach((function(n){if("string"!=typeof n){var t=""===n.prefix?null:s.location(n.prefix);""===n.prefix&&"xmlns"===n.name&&(t=s.location("xmlns"));var i=m.get(n.name),r=p(o.createAttributeNS(t,n.name),i);r.value=n.value,e.setAttributeNode(r)}})),r.appendChild(e),r=e},onOpenTagStart:function(){m=new Map},onAttribute:function(n){m.set(n.name,f())},onCloseTag:function(){if(l(r),!r.parentNode)throw new Error("End of the line!");r=r.parentNode,s.pop()},onProcessingInstruction:function(n){r.appendChild(u(o.createProcessingInstruction(n.target,n.body)))},onComment:function(n){r.appendChild(u(o.createComment(n)))},onDocType:function(n){var t,e,i,a,s=(e=(t=function(n,t){var e;void 0===t&&(t=0);var o=[],i=/'[^']+'|"[^"]+"|[^\s<>/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(n);e=i.exec(n);)if(o.push(e[0]),e[1])return o;return o}("<!DOCTYPE "+n+">"))[1],i=t[3],a=t[4],"PUBLIC"===t[2]?{qualifiedName:e,publicId:i.replace(/^"(.*)"$/,"$1"),systemId:(null==a?void 0:a.replace(/^"(.*)"$/,"$1"))||null}:{qualifiedName:e,publicId:null,systemId:i.replace(/^"(.*)"$/,"$1")});r.appendChild(u(o.implementation.createDocumentType(s.qualifiedName,s.publicId||"",s.systemId||"")))},onCdata:function(n){r.appendChild(u(o.createCDATASection(n)))},document:o}}var c=n;exports.DEFAULT_NAMESPACES=i,exports.DEFAULT_OPTIONS=o,exports.async=function(n,i){return new Promise((function(a,c){var u=r({},o,i),l=new t.SaxesParser(u),d=s(l,u);if(l.on("attribute",d.onAttribute),l.on("cdata",d.onCdata),l.on("closetag",d.onCloseTag),l.on("comment",d.onComment),l.on("doctype",d.onDocType),l.on("error",(function(n){c(n)})),l.on("opentag",d.onOpenTag),l.on("opentagstart",d.onOpenTagStart),l.on("processinginstruction",d.onProcessingInstruction),l.on("text",d.onText),void 0!==i&&void 0!==i.additionalEntities)for(var f=0,p=Object.entries(i.additionalEntities);f<p.length;f++){var m=p[f];l.ENTITIES[m[0]]=m[1]}return"string"==typeof n?(l.write(n).close(),void a(d.document)):n instanceof e.Readable?(n.on("readable",(function(){for(var t;t=n.read(n.readableHighWaterMark||8192);)l.write(t)})),void n.on("end",(function(){l.close(),a(d.document)}))):void c(new Error("Unsupported input type "+typeof n+"."))}))},exports.slimdom=c,exports.sync=function(n,e){var i=r({},o,e),a=new t.SaxesParser(i),c=s(a,i);if(a.on("attribute",c.onAttribute),a.on("cdata",c.onCdata),a.on("closetag",c.onCloseTag),a.on("comment",c.onComment),a.on("doctype",c.onDocType),a.on("opentag",c.onOpenTag),a.on("opentagstart",c.onOpenTagStart),a.on("processinginstruction",c.onProcessingInstruction),a.on("text",c.onText),void 0!==e&&void 0!==e.additionalEntities)for(var u=0,l=Object.entries(e.additionalEntities);u<l.length;u++){var d=l[u];a.ENTITIES[d[0]]=d[1]}return a.write(n).close(),c.document};
//# sourceMappingURL=slimdom-sax-parser.cjs.production.min.js.map
